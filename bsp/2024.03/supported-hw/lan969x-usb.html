<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LAN969x USB :: Microchip UNG BSP Documentation</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Microchip UNG BSP Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="bsp" data-version="2024.03">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">BSP Releases</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">ReadMe</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../release-notes/nav.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../bootloader.html">Bootloader</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Supported HW</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="lan966x.html">LAN966x</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-boot.html">Booting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-restore-secureboot.html">Restoring SecureBoot Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-tfa.html">SecureBoot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-tfa_ctl.html">TFA_CTL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-overlays.html">Overlays</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-flexcom.html">FLEXCOM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-usart.html">USART</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-spi.html">SPI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-i2c.html">I2C</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-qspi.html">QSPI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-mmc.html">MMC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-pinctrl.html">GPIO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-mcan.html">MCAN</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-wdt.html">Watchdog Timer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-aes-sha.html">Crypto HW Accelerators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-otp.html">OTP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-udphs.html">UDPHS - USB Device</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan966x-pcie-rpi4cm.html">PCIe NIC with RPI CM4</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sparx5.html">Sparx5</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="lan969x.html">LAN969x</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-boot.html">Booting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="restore-secureboot.html">Restoring SecureBoot Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-tfa.html">SecureBoot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-verified-boot.html">Verified Boot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-flexcom.html">FLEXCOM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-usart.html">USART</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-spi.html">SPI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-i2c.html">I2C</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-qspi.html">QSPI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-mmc.html">MMC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-pinctrl.html">GPIO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-sgpio.html">SGPIO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-mcan.html">MCAN</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lan969x-wdt.html">Watchdog Timer</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="lan969x-usb.html">USB Host Device</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Network</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network_overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools_overview.html">Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../front_ports.html">Front Ports</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">L2 Bridge</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../bridge_configuration.html">Bridge Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Frame Forwarding</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../forwarding_overview.html">Forwarding Overview</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../frame_meta_data.html">Frame Metadata</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tc/tc-intro.html">TC Introduction</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tc/tc-flower-vcap.html">TC and VCAP</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../vcap_tool.html">VCAP tool</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ingress</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../basic_qos.html">Basic QoS</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tc/tc-is1.html">Classification (IS0/IS1)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tc/tc-is2.html">ACL (IS2)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../policing.html">Policing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Egress</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../scheduling.html">Scheduling</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../frame_preemption.html">Frame Preemption</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../shaping.html">Shaping</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tc/tc-es2.html">Egress ACL (ES2)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tc/tc-etag.html">Basic VLAN tagging</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../tc/tc-es0.html">Rewriter VLAN tagging (ES0)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../psfp.html">PSFP</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../frer.html">FRER</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Protection switching</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mrp.html">MRP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cfm.html">CFM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ptp.html">PTP</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">BSP Releases</span>
    <span class="version">2024.03</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../2025.06/index.html">BSP Releases</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../2025.06/index.html">2025.06</a>
        </li>
        <li class="version">
          <a href="../../2025.03/index.html">2025.03</a>
        </li>
        <li class="version">
          <a href="../../2024.12/index.html">2024.12</a>
        </li>
        <li class="version">
          <a href="../../2024.09/index.html">2024.09</a>
        </li>
        <li class="version">
          <a href="../../2024.06/index.html">2024.06</a>
        </li>
        <li class="version is-current">
          <a href="../index.html">2024.03</a>
        </li>
        <li class="version">
          <a href="../../2024.03-1/index.html">2024.03-1</a>
        </li>
        <li class="version">
          <a href="../../2023.12/index.html">2023.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="#">Older (on AWS)</a>
      <ul class="versions">
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2023.09-1.html">2023.09-1</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2023.09.html">2023.09</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2023.06.html">2023.06</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2023.03.html">2023.03</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2022.12.html">2022.12</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2022.09.html">2022.09</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2022.06.html">2022.06</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2022.03.html">2022.03</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2021.12.html">2021.12</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2021.09.html">2021.09</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">BSP Releases</a></li>
    <li>Supported HW</li>
    <li><a href="lan969x.html">LAN969x</a></li>
    <li><a href="lan969x-usb.html">USB Host Device</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2024.03</button>
  <div class="version-menu">
    <a class="version" href="../../2025.06/supported-hw/lan969x-usb.html">2025.06</a>
    <a class="version" href="../../2025.03/supported-hw/lan969x-usb.html">2025.03</a>
    <a class="version" href="../../2024.12/supported-hw/lan969x-usb.html">2024.12</a>
    <a class="version" href="../../2024.09/supported-hw/lan969x-usb.html">2024.09</a>
    <a class="version" href="../../2024.06/supported-hw/lan969x-usb.html">2024.06</a>
    <a class="version is-current" href="lan969x-usb.html">2024.03</a>
    <a class="version" href="../../2024.03-1/supported-hw/lan969x-usb.html">2024.03-1</a>
    <a class="version" href="../../2023.12/supported-hw/lan969x-usb.html">2023.12</a>
  </div>
</div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">LAN969x USB</h1>
<div class="sect1">
<h2 id="_soc_resources"><a class="anchor" href="#_soc_resources"></a>1. SoC Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LAN969x SoC supports one instance of the Dual Role SuperSpeed DesignWare USB3 controller.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The current implementation supports only the host mode part of dual role
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kernel_configurations"><a class="anchor" href="#_kernel_configurations"></a>2. Kernel configurations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following kernel config options should be enabled to use LAN969x USB in host mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CONFIG_USB_DWC3</code> - DesignWare USB Controller support</p>
</li>
<li>
<p><code>CONFIG_USB_DWC3_ULPI</code> - Using an ULPI type PHY on the USB controller</p>
</li>
<li>
<p><a href="https://www.kernel.org/doc/Documentation/devicetree/bindings/usb/atmel-usb.txt">Atmel High-Speed USB device controller DT Documentation</a>
dwc3-of-simple</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_devicetree_configuration"><a class="anchor" href="#_devicetree_configuration"></a>3. Devicetree Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable LAN969x USB, following configurations are required
in device tree:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>compatible</code> string must be set to <code>"microchip,lan966x-dwc3"</code></p>
</li>
<li>
<p><code>clocks</code> property must be set to <code>&lt;&amp;clks GCK_GATE_USB_DRD&gt;</code></p>
</li>
<li>
<p><code>#address-cells</code> must be set to 1.</p>
</li>
<li>
<p><code>#size-cells</code>  must be set to 1.</p>
</li>
<li>
<p><code>ranges</code> property must be present (this is an empty address translation)</p>
</li>
<li>
<p>This node must have a child node that specifies the glue for the DWC3
controller:</p>
<div class="ulist">
<ul>
<li>
<p><code>compatible</code> string must be set to = <code>"snps,dwc3"</code>.</p>
</li>
<li>
<p><code>reg</code> property must be set to <code>&lt;0x300000 0x80000&gt;</code>.</p>
</li>
<li>
<p><code>interrupts</code> must be set to <code>&lt;GIC_SPI 80 IRQ_TYPE_LEVEL_HIGH&gt;</code></p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Peripheral</th>
<th class="tableblock halign-left valign-top">Shared Peripheral Interrupt</th>
<th class="tableblock halign-left valign-top">CPU INTR</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">USB Host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code>dr_mode</code> property must be set to <code>"host"</code>.</p>
</li>
<li>
<p><code>clocks</code> property must be set to <code>&lt;&amp;clks GCK_ID_USB_REFCLK&gt;</code>.</p>
</li>
<li>
<p><code>clock-names</code> property must be set to <code>"ref"</code>.</p>
</li>
<li>
<p><code>assigned-clocks</code> property must be set to  <code>&lt;&amp;clks GCK_ID_USB_REFCLK&gt;</code>.</p>
</li>
<li>
<p><code>assigned-clock-rates</code> property must be set to 60Mhz.</p>
</li>
<li>
<p><code>maximum-speed</code> property must be set to <code>"full-speed"</code>.</p>
</li>
<li>
<p><code>phy-names</code> property must be set to  <code>"usb2-phy"</code> and <code>"usb3-phy"</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_references"><a class="anchor" href="#_references"></a>3.1. References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://elixir.bootlin.com/linux/latest/source/Documentation/devicetree/bindings/usb/rockchip,dwc3.yaml">DWC3 Controller</a></p>
</li>
<li>
<p><a href="https://elixir.bootlin.com/linux/latest/source/Documentation/devicetree/bindings/usb/snps,dwc3.yaml">Synopsis DWC3 Glue</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_example"><a class="anchor" href="#_example"></a>3.2. Example</h3>
<div class="paragraph">
<p>Following example shows how the LAN969x USB controller should be defined in DT:</p>
</div>
<div class="paragraph">
<p>dtsi file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>usb0: usb@300000 {
	compatible = "microchip,lan966x-dwc3";
	clocks = &lt;&amp;clks GCK_GATE_USB_DRD&gt;;
	#address-cells = &lt;1&gt;; #size-cells = &lt;1&gt;;
	ranges;
	status = "disabled";

	usb0_dwc3: usb_dwc3@300000 {
		compatible = "snps,dwc3";
		reg = &lt;0x300000 0x80000&gt;;
		interrupts = &lt;GIC_SPI 80 IRQ_TYPE_LEVEL_HIGH&gt;;
		dr_mode = "host";
		clocks = &lt;&amp;clks GCK_ID_USB_REFCLK&gt;;
		clock-names = "ref";
		assigned-clocks = &lt;&amp;clks GCK_ID_USB_REFCLK&gt;;
		assigned-clock-rates = &lt;60000000&gt;;
		maximum-speed = "full-speed";
		phy-names = "usb2-phy", "usb3-phy";
		status = "okay";
	};
};</pre>
</div>
</div>
<div class="paragraph">
<p>dts file changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&amp;gpio {
	usb_ulpi_pins: usb-ulpi-pins {
		pins = "GPIO_30", "GPIO_31", "GPIO_32", "GPIO_33",
		"GPIO_34", "GPIO_35", "GPIO_36", "GPIO_37",
		"GPIO_38", "GPIO_39", "GPIO_40", "GPIO_41";
		function = "usb_ulpi";
	};

	usb_rst_pins: usb-rst-pins {
		pins = "GPIO_12";
		function = "usb2phy_rst";
	};

	usb_over_pins: usb-over-pins {
		pins = "GPIO_13";
		function = "usb_over_detect";
	};

	usb_power_pins: usb-power-pins {
		pins = "GPIO_1";
		function = "usb_power";
	};
};

&amp;usb0 {
	status = "okay";
	pinctrl-0 = &lt;&amp;usb_ulpi_pins&gt;, &lt;&amp;usb_rst_pins&gt;, &lt;&amp;usb_over_pins&gt;, &lt;&amp;usb_power_pins&gt;;
	pinctrl-names = "default";
};</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_userspace"><a class="anchor" href="#_userspace"></a>4. UserSpace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can verify that the driver is available by checking its <code>mode</code> setting is
<code>host</code>, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># cat /sys/kernel/debug/usb/300000.usb_dwc3/mode
host</pre>
</div>
</div>
<div class="sect2">
<h3 id="_mounting_a_usb_memory_stick"><a class="anchor" href="#_mounting_a_usb_memory_stick"></a>4.1. Mounting a USB Memory Stick</h3>
<div class="paragraph">
<p>Prepare a USB Memory Stick with the following properties on a Linux Desktop:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make a GTP partition table</p>
</li>
<li>
<p>Add one primary partition using the EXT4 filesystem that uses the total USB
Memory Stick space.</p>
</li>
<li>
<p>Format the partition with the ext4 formatter</p>
</li>
<li>
<p>Mount the partition on an empty folder</p>
</li>
<li>
<p>Copy a wellknown file to the mounted folder</p>
</li>
<li>
<p>Sync and unmount the folder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now insert the memory stick in the USB vertical USB port on the
EVB-LAN9696-24port and check the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># [  382.641801] usb 1-1: new high-speed USB device number 2 using xhci-hcd
[  382.790319] usb 1-1: New USB device found, idVendor=0781, idProduct=5406, bcdDevice= 2.00
[  382.795753] usb 1-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[  382.803050] usb 1-1: Product: U3 Cruzer Micro
[  382.807278] usb 1-1: Manufacturer: SanDisk
[  382.811348] usb 1-1: SerialNumber: 194253029D50FD3B
[  382.817444] usb-storage 1-1:1.0: USB Mass Storage device detected
[  382.822855] scsi host0: usb-storage 1-1:1.0
[  383.842201] scsi 0:0:0:0: Direct-Access     SanDisk  Cruzer           8.02 PQ: 0 ANSI: 0 CCS
[  383.848550] sd 0:0:0:0: [sda] Media removed, stopped polling
[  383.854874] sd 0:0:0:0: [sda] Attached SCSI removable disk

# ls /dev/sda*
/dev/sda</pre>
</div>
</div>
<div class="paragraph">
<p>The log announces a new <code>sda</code> block device which is visible in the <code>/dev</code>
folder, but what about the partition that we created?</p>
</div>
<div class="paragraph">
<p>Here you need to probe the new device for partition information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># partprobe /dev/sda
[  405.656881] sd 0:0:0:0: [sda] 15704063 512-byte logical blocks: (8.04 gb/7.49 gib)
[  405.662434] sda: detected capacity change from 0 to 15704063
[  405.693476]  sda: sda1
[  405.720651]  sda: sda1</pre>
</div>
</div>
<div class="paragraph">
<p>Partprobe informs the kernel about the partitions on device <code>sda</code> which in turn
causes the kernel to create a new <code>sda1</code> block device that represents the first
(and only) partition on <code>sda</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On Desktop Linux systems it is common to run the <code>udev</code> daemon that takes
care of retrieving partition information and spawn process that will mount these
partitions with specific user rights, but udev and its helpers are not always
available on embedded systems.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can mount the <code>sda1</code> partition to access the file that was stored
there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># mount /dev/sda1 /mnt/
[  421.617746] EXT4-fs (sda1): mounted filesystem with ordered data mode. Quota mode: disabled.
# ls -l /mnt/
total 28K
drwxr-xr-x    3 root     root        4.0K Dec 12  2023 .
drwxr-xr-x   19 1001     1001        4.0K Sep 28  2023 ..
drwx------    2 root     root       16.0K Dec 12  2023 lost+found
-rw-r--r--    1 root     root        1.4K Dec 12  2023 main.rs
# cat /mnt/main.rs
use std::fs::File;
use std::io::Read;
... file listing continues...
#</pre>
</div>
</div>
<div class="paragraph">
<p>You can now read and write to the folder as you please, and the changes will be
stored in the first partition of the USB Memory Stick.</p>
</div>
<div class="paragraph">
<p>Remember to sync and unmount the device before unplugging it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># sync
# umount /mnt/
[  897.689004] EXT4-fs (sda1): unmounting filesystem.
#</pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  This page was built using <a href="https://antora.org">Antora</a>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
