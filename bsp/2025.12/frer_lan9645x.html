<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LAN9645x FRER Configuration :: Microchip UNG BSP Documentation</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Microchip UNG BSP Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="bsp" data-version="2025.12">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">BSP Releases</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">ReadMe</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="release-notes/nav.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="getting-started.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="bootloader.html">Bootloader</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Supported HW</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="supported-hw/lan966x.html">LAN966x</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-boot.html">Booting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-tfa.html">SecureBoot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-tfa_ctl.html">TFA_CTL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-overlays.html">Overlays</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-flexcom.html">FLEXCOM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-usart.html">USART</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-spi.html">SPI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-i2c.html">I2C</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-qspi.html">QSPI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-mmc.html">MMC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-pinctrl.html">GPIO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-mcan.html">MCAN</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-wdt.html">Watchdog Timer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-aes-sha.html">Crypto HW Accelerators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-otp.html">OTP Configuration from Linux userspace</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan966x-udphs.html">UDPHS - USB Device</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="supported-hw/sparx5.html">Sparx5</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/sparx5-boot.html">Booting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/sparx5-qusxgmii.html">QUSXGMII</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="supported-hw/lan969x.html">LAN969x</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-boot.html">Booting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-tfa.html">SecureBoot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-verified-boot.html">Verified Boot</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-flexcom.html">FLEXCOM</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-usart.html">USART</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-spi.html">SPI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-i2c.html">I2C</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-qspi.html">QSPI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-mmc.html">MMC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-pinctrl.html">GPIO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-sgpio.html">SGPIO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-mcan.html">MCAN</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-wdt.html">Watchdog Timer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-otp.html">OTP Configuration from Linux userspace</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan969x-usb.html">USB Host Device</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="supported-hw/lan9645x.html">LAN9645x</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="supported-hw/lan9645x-host-use.html">Using LAN9645x with a host board</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="supported-hw/create-secureboot.html">Creating SecureBoot Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="supported-hw/restore-secureboot.html">Restoring SecureBoot Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="supported-hw/secureboot-monitor-mode.html">SecureBoot Monitor Mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="supported-hw/pcie-rpi4cm.html">PCIe Endpoint with RPI CM4</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="supported-hw/lan966x-spi-host.html">LAN9662 as a SPI host</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="network_overview.html">Network</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tools_overview.html">Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="front_ports.html">Front Ports</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tuning_performance.html">Tuning Network Performance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">L2 Bridge</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="bridge_configuration.html">Bridge Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Frame Forwarding</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="forwarding_overview.html">Forwarding Overview</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="frame_meta_data.html">Frame Metadata</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="tc/tc-intro.html">TC Introduction</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="tc/tc-flower-vcap.html">TC and VCAP</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="vcap_tool.html">VCAP tool</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ingress</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="basic_qos.html">Basic QoS</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="tc/tc-is1.html">Classification (IS0/IS1)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="tc/tc-is2.html">ACL (IS2)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="policing.html">Policing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Egress</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="scheduling.html">Scheduling</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="frame_preemption.html">Frame Preemption (deprecated)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="frame_preemption_upstream.html">Frame Preemption</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="shaping.html">Shaping</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="tc/tc-es2.html">Egress ACL (ES2)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="tc/tc-etag.html">Basic VLAN tagging</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="tc/tc-es0.html">Rewriter VLAN tagging (ES0)</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="psfp.html">PSFP</a>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="frer.html">FRER</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="frer_lan966x.html">LAN966x FRER</a>
  </li>
  <li class="nav-item is-current-page" data-depth="6">
    <a class="nav-link" href="frer_lan9645x.html">LAN9645x FRER</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="cqf.html">CQF</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="l3_unicast_routing.html">L3 Unicast Routing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Protection switching</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="mrp.html">MRP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cfm.html">CFM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ptp.html">PTP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="redbox.html">HSR/PRP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="xdp.html">eXpress Data Path (XDP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="port_security.html">802.1X Port Security</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">BSP Releases</span>
    <span class="version">2025.12</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">BSP Releases</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2025.12</a>
        </li>
        <li class="version">
          <a href="../2025.09/index.html">2025.09</a>
        </li>
        <li class="version">
          <a href="../2025.06/index.html">2025.06</a>
        </li>
        <li class="version">
          <a href="../2025.06-1/index.html">2025.06-1</a>
        </li>
        <li class="version">
          <a href="../2025.03/index.html">2025.03</a>
        </li>
        <li class="version">
          <a href="../2024.12/index.html">2024.12</a>
        </li>
        <li class="version">
          <a href="../2024.09/index.html">2024.09</a>
        </li>
        <li class="version">
          <a href="../2024.06/index.html">2024.06</a>
        </li>
        <li class="version">
          <a href="../2024.03/index.html">2024.03</a>
        </li>
        <li class="version">
          <a href="../2024.03-1/index.html">2024.03-1</a>
        </li>
        <li class="version">
          <a href="../2023.12/index.html">2023.12</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="#">Older (on AWS)</a>
      <ul class="versions">
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2023.09-1.html">2023.09-1</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2023.09.html">2023.09</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2023.06.html">2023.06</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2023.03.html">2023.03</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2022.12.html">2022.12</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2022.09.html">2022.09</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2022.06.html">2022.06</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2022.03.html">2022.03</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2021.12.html">2021.12</a>
        </li>
        <li class="version">
          <a href="http://mscc-ent-open-source.s3-eu-west-1.amazonaws.com/public_root/bsp/mscc-brsdk-doc-2021.09.html">2021.09</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">BSP Releases</a></li>
    <li><a href="network_overview.html">Network</a></li>
    <li>L2 Bridge</li>
    <li>Frame Forwarding</li>
    <li>Egress</li>
    <li><a href="frer.html">FRER</a></li>
    <li><a href="frer_lan9645x.html">LAN9645x FRER</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2025.12</button>
  <div class="version-menu">
    <a class="version is-current" href="frer_lan9645x.html">2025.12</a>
    <a class="version is-missing" href="../2025.09/index.html">2025.09</a>
    <a class="version is-missing" href="../2025.06/index.html">2025.06</a>
    <a class="version is-missing" href="../2025.06-1/index.html">2025.06-1</a>
    <a class="version is-missing" href="../2025.03/index.html">2025.03</a>
    <a class="version is-missing" href="../2024.12/index.html">2024.12</a>
    <a class="version is-missing" href="../2024.09/index.html">2024.09</a>
    <a class="version is-missing" href="../2024.06/index.html">2024.06</a>
    <a class="version is-missing" href="../2024.03/index.html">2024.03</a>
    <a class="version is-missing" href="../2024.03-1/index.html">2024.03-1</a>
    <a class="version is-missing" href="../2023.12/index.html">2023.12</a>
  </div>
</div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">LAN9645x FRER Configuration</h1>
<div class="sect1">
<h2 id="_stream_identification"><a class="anchor" href="#_stream_identification"></a>1. Stream Identification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stream Identification configuration uses the <code>vcap</code> tool which is described on the <a href="vcap_tool.html" class="xref page">VCAP Tool</a> page.</p>
</div>
<div class="paragraph">
<p>The stream identification can match on every field that is supported by IS1 but in the following examples, we will identify a stream by DMAC and VLAN. This is what is called a Null Stream identification in 802.1CB.</p>
</div>
<div class="paragraph">
<p>We will also need to match on the ingress port because we need to hit a specific ingress flow for each ingress port.</p>
</div>
<div class="paragraph">
<p>The default port key configuration in IS1 uses different keysets for different frametypes. We can change the configuration to minimize the number of required VCAP rules to match all traffic.
Moreover, this can ensure we use keys which are no larger than necessary.
See page <a href="tc/tc-is1.html" class="xref page">Classification (IS0/IS1)</a> for more information.</p>
</div>
<div class="paragraph">
<p>As we only need to match on DMAC, VLAN, and port we can use a shorter key called 'S1_DMAC_VID' which is of type X1 and only occupies 1 subword. This saves space in the VCAP that can be used for other purposes.<br></p>
</div>
<div class="paragraph">
<p>To change the IS1 VCAP port keyset configuration for port 2 and lookup 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># symreg_lan9645x ANA_VCAP_S1_CFG[2,1].KEY_OTHER_CFG 3
# symreg_lan9645x ANA_VCAP_S1_CFG[2,1].KEY_IP4_CFG 4
# symreg_lan9645x ANA_VCAP_S1_CFG[2,1].KEY_IP6_CFG 6</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to give a range of ports. To change it for ports 0,1 and 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># symreg_lan9645x ANA_VCAP_S1_CFG[0-2,1].KEY_OTHER_CFG 3
# symreg_lan9645x ANA_VCAP_S1_CFG[0-2,1].KEY_IP4_CFG 4
# symreg_lan9645x ANA_VCAP_S1_CFG[0-2,1].KEY_IP6_CFG 6</pre>
</div>
</div>
<div class="paragraph">
<p>The field KEY_OTHER_CFG uses S1_NORMAL by default and the encoding is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0: Use key S1_NORMAL
1: Use key S1_7TUPLE
2: Use key S1_DBL_VID
3: Use key S1_DMAC_VID</pre>
</div>
</div>
<div class="paragraph">
<p>The field KEY_IP4_CFG uses S1_5TUPLE_IP4 by default and the encoding is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0: Use key S1_NORMAL
1: Use key S1_7TUPLE
2: Use key S1_5TUPLE_IP4
3: Use key S1_DBL_VID
4: Use key S1_DMAC_VID</pre>
</div>
</div>
<div class="paragraph">
<p>The field KEY_IP6_CFG uses S1_5TUPLE_IP6 by default and the encoding is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0: Use key S1_NORMAL
1: Use key S1_7TUPLE
2: Use key S1_5TUPLE_IP4
3: Use key S1_NORMAL_IP6
4: Use key S1_5TUPLE_IP6
5: Use key S1_DBL_VID
6: Use key S1_DMAC_VID</pre>
</div>
</div>
<div class="paragraph">
<p><br>
The stream identification configuration depends on where the FRER functionality is located in the network. The correct ports and lookups must be configured.</p>
</div>
<div class="paragraph">
<p><br>
An example is switch S1 in the illustration above, where the stream transmitter, host A, has no FRER and VLAN functionality.</p>
</div>
<div class="paragraph">
<p>Switch S1 must identify the stream by the ingress port lan0 and DMAC 00:00:00:dd:dd:dd and classify the stream to VLAN 10 and to ISDX 1.
We will want to match only on frames that do NOT contain R-tag and C-tag.
To configure such a rule in lookup 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># vcap add 101 is1 10 1 VCAP_KFS_DMAC_VID\
    IF_IGR_PORT_MASK 0x1 0x3ff\
    R_TAGGED_IS 0x0 0x1\
    8021Q_VLAN_TAGGED_IS 0x0 0x1\
    L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff\
    VCAP_AFS_S1\
    VID_REPLACE_ENA 0x1\
    VID_VAL 0xa \
    ISDX_REPLACE_ENA 0x1\
    ISDX_ADD_VAL 0x1</pre>
</div>
</div>
<div class="paragraph">
<p>ISDX is a number between 1 and 127 that identifies the stream for later use. The maximum number if stream identifications in a switch is therefore 127.</p>
</div>
<div class="paragraph">
<p><br>
Another example is switch S2, where we will expect that the stream contains both R-tag and C-tag.</p>
</div>
<div class="paragraph">
<p>Switch S2 must identify the stream by the ingress port lan0, DMAC 00:00:00:dd:dd:dd and VLAN 10 and classify the stream to ISDX 1.
We will want to match only on frames that contain R-tag and C-tag.
To configure such a rule in lookup 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># vcap add 102 is1 10 1\
    VCAP_KFS_DMAC_VID\
    IF_IGR_PORT_MASK 0x1 0x3ff\
    R_TAGGED_IS 0x1 0x1\
    8021Q_VLAN_TAGGED_IS 0x1 0x1\
    8021Q_VID0 0xa 0xfff\
    L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff\
    VCAP_AFS_S1\
    ISDX_REPLACE_ENA 0x1\
    ISDX_ADD_VAL 0x1</pre>
</div>
</div>
<div class="paragraph">
<p><br>
To delete the stream identification above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># vcap del 101
# vcap del 102</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frer_tool"><a class="anchor" href="#_frer_tool"></a>2. FRER tool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FRER is not yet supported via standard Linux user commands and therefore a proprietary tool called <code>frer</code> is provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer --help
Usage: frer cs|msa|msf|ms|iflow|vlan [options]
options:
 --help                    Show this help text
commands:
cs:   cs cs_id [options]
 --enable:                 Enable recovery
 --alg:                    frerSeqRcvyAlgorithm (0: Vector, 1: Match)
 --hlen:                   frerSeqRcvyHistoryLength
 --reset_time:             frerSeqRcvyResetMSec
 --take_no_seq:            frerSeqRcvyTakeNoSequence
 --cnt:                    Show counters
 --clr:                    Clear counters
 --help:                   Show this help text

msa:   msa dev1 [dev2] [options]
 --help:                   Show this help text

msf:   msf ms_id [options]
 --help:                   Show this help text

ms:   ms dev ms_id [options]
 --enable:                 Enable recovery
 --alg:                    frerSeqRcvyAlgorithm (0: Vector, 1: Match)
 --hlen:                   frerSeqRcvyHistoryLength
 --reset_time:             frerSeqRcvyResetMSec
 --take_no_seq:            frerSeqRcvyTakeNoSequence
 --cs_id:                  Compound stream ID
 --cnt:                    Show counters
 --clr:                    Clear counters
 --help:                   Show this help text

iflow:   iflow id [options]
 --ms_enable:              Enable member stream
 --ms_id:                  Allocated member stream ID
 --generation:             Enable sequence generation
 --pop:                    Enable popping of R-tag
 --dev1:                   Split device 1 or '-'
 --dev2:                   Split device 2 or '-'
 --help:                   Show this help text

vlan:   vlan vid [options]
 --flood_disable:          Disable flooding in VLAN
 --learn_disable:          Disable learning in VLAN
 --help:                   Show this help text</pre>
</div>
</div>
<div class="paragraph">
<p>All frerSeqRcvXXXX parameters are defined and explained in IEEE 802.1CB-2017.</p>
</div>
<div class="paragraph">
<p><br></p>
</div>
<div class="sect2">
<h3 id="_compound_stream"><a class="anchor" href="#_compound_stream"></a>2.1. Compound Stream</h3>
<div class="paragraph">
<p>The <code>frer cs</code> command is used to configure a compound stream which is needed when you want to merge several member streams into one compound stream.</p>
</div>
<div class="paragraph">
<p>This is needed in switch S2, S3, and S4.</p>
</div>
<div class="paragraph">
<p>A compound stream is identified by a cs_id which is a number between 0 and 255.</p>
</div>
<div class="paragraph">
<p>See the FRER examples below on how to configure each switch.</p>
</div>
<div class="paragraph">
<p>To show compound stream 3 configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer cs 3
enable:               1
alg:                  0
hlen:                 4
reset_time:        1000
take_no_seq:          0</pre>
</div>
</div>
<div class="paragraph">
<p>Sequence recovery is enabled using Vector algorithm (alg = 0) with history length 4, ResetMSec is 1000 mS and TakeNoSequence is disabled.</p>
</div>
<div class="paragraph">
<p>To show compound stream 3 counters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer cs 3 --cnt
OutOfOrderPackets :                0
RoguePackets      :                0
PassedPackets     :                0
DiscardedPackets  :                0
LostPackets       :                0
TaglessPackets    :                0
Resets            :                0</pre>
</div>
</div>
<div class="paragraph">
<p>To clear compound stream 3 counters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer cs 3 --clr</pre>
</div>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_member_stream"><a class="anchor" href="#_member_stream"></a>2.2. Member Stream</h3>
<div class="paragraph">
<p>You will need a member stream if you want to enable individual recovery on a single stream and/or associate the stream with a compound stream in order to merge this stream with other streams.</p>
</div>
<div class="paragraph">
<p>A member stream is needed for each combination of ingress port/egress port. The ingress port is indirectly given via the ISDX.</p>
</div>
<div class="paragraph">
<p>This is needed in switch S2, S3, and S4.</p>
</div>
<div class="paragraph">
<p>See the FRER examples below on how to configure each switch.</p>
</div>
<div class="paragraph">
<p>A member stream is identified by a number returned by the 'frer msa' command (Member Stream Allocate).
To allocate a member stream id for lan1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer msa lan1
0</pre>
</div>
</div>
<div class="paragraph">
<p>This command returns the allocated member stream id associated with lan1.</p>
</div>
<div class="paragraph">
<p>In case you will want to split a single stream into two egress ports, you must allocate the two ports together as they will need to be associated with the same ISDX:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer msa lan1 lan2
0</pre>
</div>
</div>
<div class="paragraph">
<p>This command returns the allocated common member stream id associated with lan1 and lan2.</p>
</div>
<div class="paragraph">
<p>To show member stream 0 configuration associated with lan1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer ms lan1 0
enable:               1
alg:                  1
hlen:                 2
reset_time:        1000
take_no_seq:          0
cs_id:                3</pre>
</div>
</div>
<div class="paragraph">
<p>Individual recovery is enabled using Match algorithm (history length is N/A here), ResetMSec is 1000 mS and TakeNoSequence is disabled. This member stream is associated with compound stream 3.</p>
</div>
<div class="paragraph">
<p>To show member stream 0 counters associated with lan1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer ms lan1 0 --cnt
OutOfOrderPackets :                0
RoguePackets      :                0
PassedPackets     :                0
DiscardedPackets  :                0
LostPackets       :                0
TaglessPackets    :                0
Resets            :                0</pre>
</div>
</div>
<div class="paragraph">
<p>To clear member stream 0 counters associated with lan1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer ms lan1 0 --clr</pre>
</div>
</div>
<div class="paragraph">
<p>To free member stream 0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer msf 0 --clr</pre>
</div>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_ingress_flow"><a class="anchor" href="#_ingress_flow"></a>2.3. Ingress Flow</h3>
<div class="paragraph">
<p>An ingress flow associates an ISDX with member stream(s), controls generation/removal of R-tag, and splitting of streams.</p>
</div>
<div class="paragraph">
<p>There are some restrictions on an ingress flow:</p>
</div>
<div class="paragraph">
<p>If sequence generation is enabled then member stream association and popping of R-tag is not allowed.</p>
</div>
<div class="paragraph">
<p>See the FRER examples below on how to configure each switch.</p>
</div>
<div class="paragraph">
<p>The ISDX&#8217;s are a shared resource, and must be properly managed. You can allocate and free an ISDX by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer iflowa
1
$ frer iflowf 1</pre>
</div>
</div>
<div class="paragraph">
<p>To show ingress flow for ISDX 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer iflow 1
ms_enable:            1
ms_id:                0
generation:           0
pop:                  0
dev1:              lan1
dev2:              lan2</pre>
</div>
</div>
<div class="paragraph">
<p>ISDX 1 is associated with member stream id 0 and the stream is split into lan1 and lan2.
Neither sequence generation nor popping of R-tag is enabled.</p>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_vlan_configuration"><a class="anchor" href="#_vlan_configuration"></a>2.4. VLAN Configuration</h3>
<div class="paragraph">
<p>The VLAN configuration allows you to control flooding and learning per VLAN, which is not possible with the current standard Linux bridge vlan API.</p>
</div>
<div class="paragraph">
<p>To show VLAN configuration for VLAN 10:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ frer vlan 10
flood_disable:        1
learn_disable:        1</pre>
</div>
</div>
<div class="paragraph">
<p>Both flooding and learning are disabled in VLAN 10.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frer_examples"><a class="anchor" href="#_frer_examples"></a>3. FRER Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section described how to configure switch S1, S2, and S4 in the illustration shown above.
Switch S3 operates in a similar way as switch S2.</p>
</div>
<div class="paragraph">
<p>All examples require some common setup.</p>
</div>
<div class="paragraph">
<p>Create a VLAN-aware bridge with port lan0, lan1, and lan2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ip link add name br0 type bridge
# ip link set br0 type bridge vlan_filtering 1
# ip link set lan0 master br0
# ip link set lan1 master br0
# ip link set lan2 master br0
# ip link set lan0 up
# ip link set lan1 up
# ip link set lan2 up
# ip link set br0 up</pre>
</div>
</div>
<div class="paragraph">
<p>Add VLAN 10 to all ports and disable flooding and learning:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># bridge vlan add dev lan0 vid 10
# bridge vlan add dev lan1 vid 10
# bridge vlan add dev lan2 vid 10
# frer vlan 10 --flood_disable 1 --learn_disable 1</pre>
</div>
</div>
<div class="paragraph">
<p>Configure the IS1 VCAP to use 'S1_DMAC_VID' keysets in second lookup for ports 0, 1 and 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># symreg_lan9645x ANA_VCAP_S1_CFG[0-2,1].KEY_OTHER_CFG 3
# symreg_lan9645x ANA_VCAP_S1_CFG[0-2,1].KEY_IP4_CFG 4
# symreg_lan9645x ANA_VCAP_S1_CFG[0-2,1].KEY_IP6_CFG 6
# symreg_lan9645x ANA_VCAP_S1_CFG[0-2,1].KEY_RT_CFG 7</pre>
</div>
</div>
<div class="paragraph">
<p>This is only necessary on ports where we use stream identification.</p>
</div>
<div class="paragraph">
<p>Now the different switches can be configured.</p>
</div>
<div class="paragraph">
<p><br></p>
</div>
<div class="sect2">
<h3 id="_switch_s1"><a class="anchor" href="#_switch_s1"></a>3.1. Switch S1</h3>
<div class="paragraph">
<p>Switch S1 must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify the untagged stream as stream 0 and associate it with ISDX 1 and VLAN 10</p>
</li>
<li>
<p>Generate a sequence number to insert in an R-tag</p>
</li>
<li>
<p>Split the traffic into two egress ports</p>
</li>
<li>
<p>Add C-tag and R-tag on egress</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that individual and sequence recovery is not used in this setup.</p>
</div>
<div class="paragraph">
<p>lan0 is connected to host A.<br>
lan1 is connected to switch S2.<br>
lan2 is connected to switch S3.</p>
</div>
<div class="paragraph">
<p>Allocate an ISDX to use for the stream. Then create a VCAP rule in lookup 1 with ID=101 and priority 10 for stream identification and VLAN classification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ISDX=$(frer iflowa)
# vcap add 101 is1 10 1 VCAP_KFS_DMAC_VID\
    IF_IGR_PORT_MASK 0x1 0x3ff\
    R_TAGGED_IS 0x0 0x1\
    8021Q_VLAN_TAGGED_IS 0x0 0x1\
    L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff\
    VCAP_AFS_S1\
    VID_REPLACE_ENA 0x1\
    VID_VAL 0xa \
    ISDX_REPLACE_ENA 0x1\
    ISDX_ADD_VAL $ISDX</pre>
</div>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VCAP_KFS_DMAC_VID - IS1 key</p>
<div class="ulist">
<ul>
<li>
<p>LOOKUP 0x01 0xff - Second lookup</p>
</li>
<li>
<p>IF_IGR_PORT_MASK 0x001 0x3ff - Match on lan0 (port 0)</p>
</li>
<li>
<p>R_TAGGED 0 - Frame must be without an R-tag</p>
</li>
<li>
<p>8021Q_VLAN_TAGGED_IS 0x0 0x1 - Frame must be without a C-tag</p>
</li>
<li>
<p>L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff - Match on all bits in host B MAC address</p>
</li>
</ul>
</div>
</li>
<li>
<p>VCAP_AFS_S1 - IS1 action</p>
<div class="ulist">
<ul>
<li>
<p>VID_REPLACE_ENA 1 - Enable replace VID classification</p>
</li>
<li>
<p>VID_ADD_VAL 0XA - VID to classify to</p>
</li>
<li>
<p>ISDX_REPLACE_ENA 1 - Enable replace ISDX classification</p>
</li>
<li>
<p>ISDX_ADD_VAL $ISDX - ISDX to classify to..</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use allocated ISDX to setup the stream to generate R-tag (Sequence Generation) and transmit on lan1 and lan2 (Stream Split):</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer iflow $ISDX --generation 1 --dev1 lan1 --dev2 lan2</pre>
</div>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_switch_s2"><a class="anchor" href="#_switch_s2"></a>3.2. Switch S2</h3>
<div class="paragraph">
<p>Switch S2 must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify the C-tagged and R-tagged stream from switch S1 as part of member stream 1 and associate it with ISDX 1</p>
</li>
<li>
<p>Identify the C-tagged and R-tagged stream from switch S3 as part of member stream 2 and associate it with ISDX 2</p>
</li>
<li>
<p>Apply individual recovery to both member streams 1 and 2</p>
</li>
<li>
<p>Split member stream 1 into two egress ports</p>
</li>
<li>
<p>Merge member streams 1 and 2 by mapping them to the same compound stream</p>
</li>
<li>
<p>Apply sequence recovery to the compound stream consisting of member streams 1 and 2 and discard one of the frames</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>lan0 is connected to switch S1.<br>
lan1 is connected to switch S3.<br>
lan2 is connected to switch S4.</p>
</div>
<div class="paragraph">
<p>Allocate ISDX for stream 1, and create a VCAP rule in lookup 1 with priority 10 and ID 101 for stream identification of stream (1):</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ISDX1=$(frer iflowa)
# vcap add 101 is1 10 1\
    VCAP_KFS_DMAC_VID\
    IF_IGR_PORT_MASK 0x1 0x3ff\
    R_TAGGED_IS 0x1 0x1\
    8021Q_VLAN_TAGGED_IS 0x1 0x1\
    8021Q_VID0 0xa 0xfff\
    L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff\
    VCAP_AFS_S1\
    ISDX_REPLACE_ENA 0x1\
    ISDX_ADD_VAL $ISDX1</pre>
</div>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VCAP_KFS_DMAC_VID - IS1 key</p>
<div class="ulist">
<ul>
<li>
<p>IF_IGR_PORT_MASK 0x001 0x3ff - Match on lan0 (port 0)</p>
</li>
<li>
<p>R_TAGGED 0x1 0x1 - Frame must be R-tagged</p>
</li>
<li>
<p>8021Q_VLAN_TAGGED_IS 0x1 0x1 - Frame must be C-tagged</p>
</li>
<li>
<p>8021Q_VID0 0xa 0xfff - VID must be 10</p>
</li>
<li>
<p>L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff - Match on all bits in host B MAC address</p>
</li>
</ul>
</div>
</li>
<li>
<p>VCAP_AFS_S1 - IS1 action</p>
<div class="ulist">
<ul>
<li>
<p>ISDX_REPLACE_ENA 1 - Enable replace ISDX classification</p>
</li>
<li>
<p>ISDX_ADD_VAL $ISDX1 - ISDX to classify to..</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Allocate an ISDX for stream 2, and create a VCAP rule in lookup 1 with priority 10 and ID 102 for stream identification of stream (2):</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ISDX2=$(frer iflowa)
# vcap add 102 is1 10 1 VCAP_KFS_DMAC_VID\
     IF_IGR_PORT_MASK 0x2 0x3ff\
     R_TAGGED_IS 0x1 0x1\
     8021Q_VLAN_TAGGED_IS 0x1 0x1\
     8021Q_VID0 0xa 0xfff\
     L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff\
     VCAP_AFS_S1\
     ISDX_REPLACE_ENA 0x1\
     ISDX_ADD_VAL $ISDX2</pre>
</div>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VCAP_KFS_DMAC_VID - IS1 key</p>
<div class="ulist">
<ul>
<li>
<p>IF_IGR_PORT_MASK 0x002 0x3ff - Match on lan1 (port 1)</p>
</li>
<li>
<p>R_TAGGED 0x1 0x1 - Frame must be R-tagged</p>
</li>
<li>
<p>8021Q_VLAN_TAGGED_IS 0x1 0x1 - Frame must be C-taggged</p>
</li>
<li>
<p>8021Q_VID0 0xa 0xfff - VID must be 10</p>
</li>
<li>
<p>L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff - Match on all bits in host B MAC address</p>
</li>
</ul>
</div>
</li>
<li>
<p>VCAP_AFS_S1 - IS1 action</p>
<div class="ulist">
<ul>
<li>
<p>ISDX_REPLACE_ENA 1 - Enable replace ISDX classification</p>
</li>
<li>
<p>ISDX_ADD_VAL $ISDX1 - ISDX to classify to..</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configure compound stream 3 with vector algorithm, maximum history length 32, and reset_time 4000 milliseconds</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer cs 3 --enable 1 --alg 0 --hlen 32 --reset_time 4000</pre>
</div>
</div>
<div class="paragraph">
<p>Allocate member stream id for egress on lan1 and lan2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># MS_ID1=$(frer msa lan1 lan2)</pre>
</div>
</div>
<div class="paragraph">
<p>The number returned will later be used as ms_id for member stream 1</p>
</div>
<div class="paragraph">
<p>Allocate member stream id for egress on lan2 only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># MS_ID2=$(frer msa lan2)</pre>
</div>
</div>
<div class="paragraph">
<p>The number returned will later be used as ms_id for member stream 2</p>
</div>
<div class="paragraph">
<p>Setup member stream 1 on lan1 with match algorithm, reset_time 4000 milliseconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer ms lan1 $MS_ID1 --enable 1 --alg 1 --reset_time 4000</pre>
</div>
</div>
<div class="paragraph">
<p>Setup member stream 1 on lan2 with match algorithm, reset_time 4000 milliseconds, and compound stream 3:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer ms lan2 $MS_ID1 --enable 1 --alg 1 --reset_time 4000 --cs_id 3</pre>
</div>
</div>
<div class="paragraph">
<p>Setup member stream 2 on lan2 with match algorithm, reset_time 4000 milliseconds, and compound stream 3:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer ms lan2 $MS_ID2 --enable 1 --alg 1 --reset_time 4000 --cs_id 3</pre>
</div>
</div>
<div class="paragraph">
<p>Associate $ISDX1 with member stream 1 ($MS_ID1) and split the stream into lan1 and lan2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer iflow $ISDX1 --ms_enable 1 --ms_id $MS_ID1 --dev1 lan1 --dev2 lan2</pre>
</div>
</div>
<div class="paragraph">
<p>Associate $ISDX2 with member stream 2 ($MS_ID2) and lan2 only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer iflow $ISDX2 --ms_enable 1 --ms_id $MS_ID2 --dev1 lan2</pre>
</div>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_switch_s4"><a class="anchor" href="#_switch_s4"></a>3.3. Switch S4</h3>
<div class="paragraph">
<p>Switch S4 must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify the C-tagged and R-tagged stream from switch S2 as part of member stream 3 and associate it with $ISDX3</p>
</li>
<li>
<p>Identify the C-tagged and R-tagged stream from switch S3 as part of member stream 4 and associate it with $ISDX4</p>
</li>
<li>
<p>Apply individual recovery to both member stream 3 and 4</p>
</li>
<li>
<p>Merge member stream 3 and 4 by mapping them to the same compound stream</p>
</li>
<li>
<p>Apply sequence recovery to the compound stream consisting of member stream 3 and 4 and discard one of the frames</p>
</li>
<li>
<p>Remove C-tag and R-tag</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>lan0 is connected to switch S2.<br>
lan1 is connected to switch S3.<br>
lan2 is connected to host B.</p>
</div>
<div class="paragraph">
<p>Allocate an ISDX for stream 3, and create a VCAP rule in lookup 1 with priority 10 and ID 103 for stream identification of stream (3):</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ISDX3=$(frer iflowa)
# vcap add 103 is1 10 1\
    VCAP_KFS_DMAC_VID\
    IF_IGR_PORT_MASK 0x1 0x3ff\
    R_TAGGED_IS 0x1 0x1\
    8021Q_VLAN_TAGGED_IS 0x1 0x1\
    8021Q_VID0 0xa 0xfff\
    L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff\
    VCAP_AFS_S1\
    ISDX_REPLACE_ENA 0x1\
    ISDX_ADD_VAL $ISDX3</pre>
</div>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VCAP_KFS_DMAC_VID - IS1 key</p>
<div class="ulist">
<ul>
<li>
<p>IF_IGR_PORT_MASK 0x001 0x3ff - Match on lan0 (port 0)</p>
</li>
<li>
<p>R_TAGGED 0x1 0x1 - Frame must be R-tagged</p>
</li>
<li>
<p>8021Q_VLAN_TAGGED_IS 0x1 0x1 - Frame must be C-taggged</p>
</li>
<li>
<p>8021Q_VID0 0xa 0xfff - VID must be 10</p>
</li>
<li>
<p>L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff - Match on all bits in host B MAC address</p>
</li>
</ul>
</div>
</li>
<li>
<p>VCAP_AFS_S1 - IS1 action</p>
<div class="ulist">
<ul>
<li>
<p>ISDX_REPLACE_ENA 1 - Enable replace ISDX classification</p>
</li>
<li>
<p>ISDX_ADD_VAL $ISDX3 - ISDX to classify to.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Allocate an ISDX for stream 4, and create a VCAP rule in lookup 1 with priority 10 and ID 104 for stream identification of stream (4):</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ISDX4=$(frer iflowa)
# vcap add 104 is1 10 1\
    VCAP_KFS_DMAC_VID\
    IF_IGR_PORT_MASK 0x2 0x3ff\
    R_TAGGED_IS 0x1 0x1\
    8021Q_VLAN_TAGGED_IS 0x1 0x1\
    8021Q_VID0 0xa 0xfff\
    L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff\
    VCAP_AFS_S1\
    ISDX_REPLACE_ENA 0x1\
    ISDX_ADD_VAL $ISDX4</pre>
</div>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VCAP_KFS_DMAC_VID - IS1 key</p>
<div class="ulist">
<ul>
<li>
<p>IF_IGR_PORT_MASK 0x002 0x3ff - Match on lan1 (port 1)</p>
</li>
<li>
<p>R_TAGGED 0x1 0x1 - Frame must be R-tagged</p>
</li>
<li>
<p>8021Q_VLAN_TAGGED_IS 0x1 0x1 - Frame must be C-taggged</p>
</li>
<li>
<p>8021Q_VID0 0xa 0xfff - VID must be 10</p>
</li>
<li>
<p>L2_DMAC 00:00:00:dd:dd:dd ff:ff:ff:ff:ff:ff - Match on all bits in host B MAC address</p>
</li>
</ul>
</div>
</li>
<li>
<p>VCAP_AFS_S1 - IS1 action</p>
<div class="ulist">
<ul>
<li>
<p>ISDX_REPLACE_ENA 1 - Enable replace ISDX classification</p>
</li>
<li>
<p>ISDX_ADD_VAL $ISDX4 - ISDX to classify to.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add static MAC address in VLAN 10 on lan2. This is needed if no splitting is involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># bridge fdb add 00:00:00:dd:dd:dd dev lan2 static master vlan 10</pre>
</div>
</div>
<div class="paragraph">
<p>Configure compound stream 4 with vector algorithm, history length 32, and reset_time 4000 milliseconds</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer cs 4 --enable 1 --alg 0 --hlen 32 --reset_time 4000</pre>
</div>
</div>
<div class="paragraph">
<p>Allocate member stream id for egress on lan2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># MS_ID3=$(frer msa lan2)</pre>
</div>
</div>
<div class="paragraph">
<p>The number returned will later be used as ms_id for member stream 3</p>
</div>
<div class="paragraph">
<p>Allocate member stream id for egress on lan2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># MS_ID4=$(frer msa lan2)</pre>
</div>
</div>
<div class="paragraph">
<p>The number returned will later be used as ms_id for member stream 4</p>
</div>
<div class="paragraph">
<p>Setup member stream 3 on lan2 (ms_id 0) with match algorithm, reset_time 4000 milliseconds, and compound stream 0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer ms lan2 $MS_ID3 --enable 1 --alg 1 --reset_time 4000 --cs_id 4</pre>
</div>
</div>
<div class="paragraph">
<p>Setup member stream 4 on lan2 (ms_id 2) with match algorithm, reset_time 4000 milliseconds, and compound stream 0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer ms lan2 $MS_ID4 --enable 1 --alg 1 --reset_time 4000 --cs_id 4</pre>
</div>
</div>
<div class="paragraph">
<p>Associate $ISDX3 with member stream 3 ($MS_ID3), pop R-tag and set egress to lan2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer iflow $ISDX3 --ms_enable 1 --ms_id $MS_ID3 --pop 1 --dev1 lan2</pre>
</div>
</div>
<div class="paragraph">
<p>Associate $ISDX4 with member stream 4 ($MS_ID4), pop R-tag and set egress to lan2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># frer iflow $ISDX4 --ms_enable 1 --ms_id $MS_ID4 --pop 1 --dev1 lan2</pre>
</div>
</div>
<div class="paragraph">
<p>Create a VCAP rule with priority 10 and handle 0 to remove the VLAN tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># vcap add 301 es0 10 0\
    VCAP_KFS_VID\
    IF_EGR_PORT 0x2 0xfff\
    8021Q_VID_CLS 0xa 0xfff\
    VCAP_AFS_VID\
    PUSH_OUTER_TAG 3</pre>
</div>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VCAP_KFS_VID - ES0 key</p>
<div class="ulist">
<ul>
<li>
<p>IF_EGR_PORT_NO 2 0xf - Match on egress on lan2 (port 2)</p>
</li>
<li>
<p>8021Q_VID_CLS 0xa 0xfff - VID must be 10</p>
</li>
</ul>
</div>
</li>
<li>
<p>VCAP_AFS_VID - ES0 action</p>
<div class="ulist">
<ul>
<li>
<p>PUSH_OUTER_TAG 3 - Force untag</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  This page was built using <a href="https://antora.org">Antora</a>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
